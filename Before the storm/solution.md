### é¢˜ç›®

å‡ å¤©å‰ï¼ŒUwU Lend è¢«ç›—å–äº† 2000 ä¸‡ç¾å…ƒï¼Œä½ å‘ç°æ¼æ´åˆ©ç”¨è€…ï¼ˆhttps://etherscan.io/address/0x6F8C5692b00c2eBbd07e4FD80E332DfF3ab8E83cï¼‰çš„ Llamalend ä»“ä½å˜å¾—ä¸å¥åº·ï¼Œæ‰€ä»¥æ˜¯æ—¶å€™æ¸…ç®—äº†ã€‚ä½ ç›®å‰æ²¡æœ‰èµ„é‡‘ï¼Œæ‰€ä»¥å”¯ä¸€çš„åŠæ³•å°±æ˜¯ä½¿ç”¨é—ªç”µè´·ã€‚

æ¸…ç®—åï¼Œå°½ä¸€åˆ‡åŠªåŠ›ç¡®ä¿ä½ çš„æ³¨å†Œé’±åŒ…ä¸­è‡³å°‘æœ‰ 2 ä¸‡ CRVã€‚

### è¯´æ˜

è¿™ä¸ªé—®é¢˜ç®—æ˜¯æˆ‘ä¸ªäººæœ€ä¸ºæ„Ÿå…´è¶£çš„ä¸€é“é—®é¢˜äº†ï¼Œä¸»è¦ç”±äºé—ªç”µè´·è¿™ä¸ªä¸œè¥¿ã€‚è¿™ä¸ªæ˜¯æˆ‘æ¥è§¦web3ä»¥æ¥ï¼Œè§‰å¾—æœ€æœ‰æ„æ€çš„ä¸€ä¸ªä¸œè¥¿ï¼Œå®ƒèƒ½å¤Ÿåˆ©ç”¨åŒºå—é“¾çš„ç‰¹æ€§ï¼Œè®©äººä»¬èƒ½å¤Ÿé€šè¿‡åˆçº¦è°ƒç”¨å®Œæˆä¸Šäº¿ç¾é‡‘çš„å€Ÿè´·è°ƒç”¨ï¼Œå³ä½¿æ˜¯èº«æ— åˆ†æ–‡çš„æ™®é€šäººï¼Œåªè¦å‡‘å¤Ÿè¶³å¤Ÿçš„æ‰‹ç»­è´¹å°±èƒ½å¤Ÿè¿›è¡Œã€‚æ›¾ç»å°è¯•è¿‡åœ¨remixä¸Šç¼–å†™è‡ªå·±çš„é—ªç”µè´·åˆçº¦ï¼Œä½†å’Œå®æˆ˜ç›¸æ¯”æ€»æ˜¯è§‰å¾—é£Ÿä¹‹æ— å‘³ã€‚

https://x.com/vanisaxxm/status/1958396749485400213 å…³äºé—ªç”µçš„ç§‘æ™®è§†é¢‘æ¨èè¿™ä½åšä¸»çš„ã€‚

### ç¬¬ä¸€æ¬¡å°è¯•çš„æ€è·¯

é¦–å…ˆé€šè¿‡é¢˜ç›®ä¸­ç»™çš„åœ°å€ï¼ˆ0x6F8C5692b00c2eBbd07e4FD80E332DfF3ab8E83cï¼‰ï¼Œé€šè¿‡é“¾æ¥è¿›å»ä¼šå‘ç°è¿™ä¸ªå…¶å®ä¸æ˜¯æ”»å‡»è€…çš„åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªåˆçº¦åœ°å€ï¼Œä½†æ˜¯åŸºäºè¿™ä¸ªåˆçº¦åœ°å€å°±å¯ä»¥çŸ¥é“æ”»å‡»è€…çš„åœ°å€ï¼ˆhttps://etherscan.io/address/0x841ddf093f5188989fa1524e7b893de64b421f47ï¼‰ï¼Œè¿™ä¸ªåˆçº¦å®é™…æ˜¯æ”»å‡»è€…çš„å€Ÿè´·ä»“ä½ã€‚

```solidity
markets: 14 Controller[3]=0xEdA215b7666936DEd834f76f3fBC6F323295110A coll=0xD533a949740bb3306d119CC777fa900bA034cd52 borr=0xf939E0A03FB07F59A73314E73794Be0E57ac1b4E borrower debt = 8127727396534152807708083 >> TARGET CONTROLLER = 0xEdA215b7666936DEd834f76f3fBC6F323295110A
```

- **Controller**: `0xEdA215b7666936DEd834f76f3fBC6F323295110A`
- **æŠµæŠ¼**: CRVï¼Œ**å€Ÿæ¬¾**: crvUSD
- **Exploiter å€ºåŠ¡**: `8127727396534152807708083` wei â‰ˆ **8,127,727.396534153 crvUSD**

æ¸…ç®—çš„åŸºæœ¬è·¯å¾„åº”è¯¥æ€ä¹ˆåšï¼Ÿéƒ¨ç½²åˆçº¦-å†™å¥½è„šæœ¬ï¼Œç„¶åä½¿ç”¨è„šæœ¬è°ƒç”¨å·²ç»éƒ¨ç½²åœ¨é“¾ä¸Šçš„åˆçº¦å¯¹å…¶ä»“ä½æ‰§è¡Œäº¤äº’ã€‚

è¿™ä¸ªæ˜¯éƒ¨ç½²åœ¨fork chainä¸Šçš„åˆçº¦ï¼Œæˆ‘æœ€å¼€å§‹çš„æ€è·¯æ˜¯å€Ÿè´·usdtï¼Œç„¶åå…‘æ¢æˆcrvUSDã€‚

ï¼ˆ1ï¼‰ç»“æœå‘ç°è„šæœ¬è°ƒç”¨åˆçº¦çš„æ—¶å€™ï¼Œæ—©æœŸå°±ç›´æ¥è¢«revertï¼Œç»è¿‡æ’æŸ¥å‘ç°å¯å€Ÿè´·usdtæ•°é‡ä¸å¤Ÿæˆ‘å®Œæˆè¿™ä¹ˆå·¨é¢çš„æ¸…ç®—ã€‚

```tsx
// æŸ¥çœ‹å€Ÿè´·åˆçº¦ä¸­æœ‰è¯¥ç§ä»£å¸æœ‰å¤šå°‘
const balance = await tokenContract.balanceOf(BALANCER_VAULT);
const balanceFormatted = parseFloat(ethers.formatUnits(balance, token.decimals));
const valueUSD = balanceFormatted * token.priceUSD;
```

åœ¨æŸ¥é˜…å®Œï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å€Ÿè´·åˆçº¦ä¸­çš„ETHæ˜¯ä»·å€¼æœ€å¤šçš„ï¼Œé‚£ä¹ˆç”¨å…¶å»è¿›è¡Œæ¸…ç®—æœ€ä¸ºåˆé€‚ã€‚

```solidity
PS E:\library\web3\Before the storm\uwu-llama-liquidation> npm run deploy

> uwu-llama-liquidation@1.0.0 deploy
> hardhat run scripts/deploy.ts --network tenderly

Deployer: 0x0cf6b1bBa533AfCBb6014e40385a5B26dbB0dA5c
UltiLiquidator deployed at: 0x326A937B0ACd264e6F35b5d0d2C6557b93115378
âœ… åœ°å€å·²ä¿å­˜åˆ° deployments.json
ğŸ“ æ–‡ä»¶è·¯å¾„: E:\library\web3\Before the storm\uwu-llama-liquidation\deployments.json
```

è¿™æ˜¯æˆ‘éƒ¨ç½²å®Œåˆçº¦åï¼Œå†™çš„è„šæœ¬

```solidity
const [s] = await ethers.getSigners();
const liquidator = await ethers.getContractAt(
  "UltiLiquidator",
  "0xC0D97B8d708b419d62D5476A725B41e33D77877c",
  s
);

const controllerAddress = "0xEdA215b7666936DEd834f76f3fBC6F323295110A";
const borrowerAddress   = "0x6F8C5692b00c2eBbd07e4FD80E332DfF3ab8E83c";
const beneficiary       = "0x0cf6b1bBa533AfCBb6014e40385a5B26dbB0dA5c";

// 1) è¯»å€ºåŠ¡
const ctl = await ethers.getContractAt(
  ["function debt(address) view returns (uint256)",
   "function user_state(address) view returns (uint256 collateral, uint256 debt)"],
  controllerAddress, s
);
let debt;
try { debt = await ctl.debt(borrowerAddress); } catch { [,debt] = await ctl.user_state(borrowerAddress); }

// 2) Quoter ä¼°ç®— USDC -> ç²¾ç¡®ä¹°å‡º debt crvUSD æ‰€éœ€çš„ USDCï¼ˆ500 å¤±è´¥åˆ™ç”¨ 3000ï¼‰
const USDC   = "0xA0b86991c6218b36c1d19d4a2e9eb0ce3606eb48";
const CRVUSD = "0xF939E0A03FB07F59A73314E73794Be0E57ac1b4E";
const QUOTER = "0x61fFE014bA179E9aBfDEB4DfD0b4eAAdA6d6f2A3";

const quoter = await ethers.getContractAt(
  ["function quoteExactOutputSingle((address,address,uint256,uint24,uint160)) view returns (uint256,uint160,uint32,uint256)"],
  QUOTER, s
);

let fee = 500;
let needUSDC;
try {
  [needUSDC] = await quoter.quoteExactOutputSingle([USDC, CRVUSD, debt, fee, 0n]);
} catch {
  fee = 3000;
  [needUSDC] = await quoter.quoteExactOutputSingle([USDC, CRVUSD, debt, fee, 0n]);
  console.log("ç”¨ 0.3% è´¹æ¡£");
}
const flashUSDC = (needUSDC * 101n) / 100n;

// 3) å‘é€äº¤æ˜“ï¼ˆç»™è¶³ gasLimitï¼‰
const tx = await liquidator.flashAndLiquidate(
  controllerAddress,
  borrowerAddress,
  beneficiary,
  debt,
  flashUSDC,
  ethers.parseUnits("20000", 18),
  { gasLimit: 25_000_000 }
);
console.log("tx:", tx.hash);
const rcpt = await tx.wait();
console.log("done. gasUsed:", rcpt.gasUsed.toString());

```

```solidity
Target:
Controller: 0xEdA215b7666936DEd834f76f3fBC6F323295110A
Exploiter: 0x6F8C5692b00c2eBbd07e4FD80E332DfF3ab8E83c
Debt: 4349978.843031908306047379 crvUSD
Collateral: 12072666.352370194900945047 CRV

Liquidation:
Debt Amount: 4349978.843031908306047379 crvUSD
Flash Loan Amount: 2084.3648622861224 WETH
Debt Value: ~$4349979

ğŸ”§ éªŒè¯åŸºç¡€è®¾æ–½...
Controller: âœ…
Balancer Vault: âœ…
Uniswap V2 Router: âœ…
CRV Token: âœ…
crvUSD Token: âœ…
WETH Token: âœ…
USDT Token: âœ…
Curve crvUSD/USDT Pool: âœ…

ğŸ” éªŒè¯å½“å‰ç”¨æˆ·çŠ¶æ€...
å½“å‰æŠµæŠ¼å“: 12072666.352370194900945047 CRV
å½“å‰å€ºåŠ¡: 4349978.843031908306047379 crvUSD
```

ï¼ˆ2ï¼‰åœ¨æ¯”èµ›æ—¶ï¼Œåå¤å°è¯•æ¸…ç®—éƒ½å¤±è´¥äº†ï¼Œç»è¿‡èµ›åæŸ¥çœ‹https://github.com/Frodan/wintermute-alpha-2025-writeups/blob/main/Before%20The%20Storm/Writeup.md çš„è§£ç­”ï¼Œå‘ç°æ­£ç¡®çš„æ–¹å¼æ˜¯åˆ†æ‰¹æ¸…ç®—ã€‚

**è¿™ä¸ªæ˜¯UwU lendåªå…è®¸æ¸…ç®—ä¸€å°éƒ¨åˆ†ã€‚è¿™ä¸€ç‚¹æ²¡èƒ½æ„è¯†åˆ°å’Œè§£å†³çš„ä¸»è¦åŸå› åœ¨äºæˆ‘æ²¡èƒ½å¾ˆå¥½çš„æŸ¥é˜…å€Ÿè´·åè®®æä¾›çš„æ–‡æ¡£ï¼ˆ**https://github.com/UwU-Lend/uwu-contracts/blob/main/aave-protocol-v2/protocol/lendingpool/LendingPoolCollateralManager.sol**ï¼‰ã€‚**

```solidity
 uint256 internal constant LIQUIDATION_CLOSE_FACTOR_PERCENT = 5000;

 vars.maxLiquidatableDebt = vars.userStableDebt.add(vars.userVariableDebt).percentMul(
      LIQUIDATION_CLOSE_FACTOR_PERCENT
    );
```

åç»­å°±æ˜¯éƒ¨ç½²å…·ä½“çš„æ¸…ç®—åˆçº¦ï¼Œç„¶åå¤šæ¬¡æ¸…ç®—ï¼Œæ¯æ¬¡æ¸…ç®—ä¸€å°éƒ¨åˆ†

### æ€»ä½“æ€è·¯

ç›®æ ‡æ˜¯æ¸…ç®— UwU exploiter åœ¨ **Curve LlamaLend çš„ CRV-long å¸‚åœº**çš„åè´¦ï¼Œç”¨**é—ªç”µè´·**æ‹¿åˆ° crvUSD å¿è¿˜å€ºåŠ¡ï¼Œæ‹¿å›æŠ˜ä»·çš„ CRV ä½œä¸ºæ¸…ç®—å¥–åŠ±ï¼Œå¹¶åœ¨è¿˜æ¸…é—ªç”µè´·åï¼Œä¿è¯ä½ çš„**å·²æ³¨å†Œé’±åŒ…**é‡Œè‡³å°‘ç•™æœ‰ 20,000 æš CRVã€‚

UwU Lend ä¸Šçš„ä¸å¥åº·ä»“ä½æ˜¯ CRV/crvUSD ä»“ä½ã€‚åœ¨å…¸å‹çš„æ¸…ç®—ä¸­ï¼Œæ¸…ç®—äººæ”¯ä»˜ crvUSD å¹¶è·å¾— CRV åŠæº¢ä»·ä½œä¸ºå¥–åŠ±ã€‚æœ‰è¶£çš„æ˜¯ï¼ŒUwU Lend æ”¯æŒé—ªç”µæ¸…ç®—ï¼Œå…è®¸æ‚¨å…ˆæ”¶åˆ° CRVï¼Œç„¶ååœ¨äº¤æ˜“ç»“æŸå‰è¿”è¿˜æ‰€éœ€çš„ crvUSD é‡‘é¢ã€‚æ­¤å¤–ï¼Œè™½ç„¶ä»“ä½è§„æ¨¡å¾ˆå¤§ï¼Œä½† UwU Lend æ¯æ¬¡åªå…è®¸æ¸…ç®—ä¸€å°éƒ¨åˆ†ã€‚